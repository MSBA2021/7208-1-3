#Path Analysis in R
#Example for WHBM

install.packages(c("lavaan", "semPlot"))

library(lavaan)
library(semPlot)

#Here is the code for one of the WHBM data path models:

#lavaan SEM Path Analysis
  
dat <- read.spss("WHBM7040.sav", to.data.frame = TRUE, use.value.labels = FALSE)
head(dat)
nrow(dat)

model <- '
# specify regressions
TotalYearlyACTV ~ a*ValueForPrice + b*cussat
cussat ~ c*sophis + d*ValueForPrice + e*csr + f*empsim
 
# specify residual covariances. These residual variances represent the correlations among exogenous constructs.

sophis ~~ empsim
sophis ~~ csr
sophis ~~ ValueForPrice
ValueForPrice ~~ csr
ValueForPrice ~~ empsim
csr ~~ empsim
 

# calculate indirect effects (manually). These indirect effects are represented by the arrows in the model.

sophis_TotalYearlyACTV := c * b
ValueForPrice_TotalYearlyACTV := d * b
empsim_TotalYearlyACTV := f * b
csr_TotalYearlyACTV := e * b
 
# calculate total effects (manually). Here you have to sum up the direct and indirect effects manually to get the total effects.


TOTAL_ValueForPrice_TotalYearlyACTV := d * b + a
'
#FitModel
fit <- sem(model, data = dat)
summary(fit, standardized = TRUE, fit.measures = TRUE, modindices = TRUE)
semPaths(fit, whatLabels = "est", edge.label.cex = 1.1, label.cex = 2, layout = "tree2")
